# cfapdbparse.py

This python script automates the process of building an input script for `psfgen` using as much information as possible in the published PDB file.  

Cameron F Abrams -- cfa22@drexel.edu

2020


### How it works:

`cfapdbparse` parses most of the PDB records necessary to build a complete psfgen input script.  It uses SEQRES records to build chains, the REMARK 465 records to indicate missing residues, and the LINK and SSBOND records to include the proper bond patches.  It will generate replica protomers using BIOMT records to generate multimers.  It can generate the proper commands to mutate residues and cleave chains.

`cfapdbparse` is still a work in progress and has not been widely tested on random PDB entries.  Don't use it for any systems with ligands or co-factors (yet).  So far, the only HET's recognized are glycans.

A generic workflow might look like this:

```
> python cfadpbparse.py -pdb ####.pdb
> vmd -dispdev text mkpsf.tcl
> charmrun +pX namd2 my_####_vac.namd
```

The first command generates the `mkpsf.tcl` psfgen script; the second runs it to generate the initial psf/pdb pair, and the third runs the warmup simulation prior to solvation.

By default, `cfapdbparse` assumes the input PDB file is an official entry in the PDB.  However, if it detects the keyword CHARMM in the KEYWDS record, it will then assume the PDB is in CHARMM format (in particular with regard to atom names and residue names).  This allows for chained processing, where a preliminary system is created and warmed-up, and then subsequently reprocessed through psfgen to add some other components or features.  This feature of `cfapdbparse` is functional, but the filename generation is not optimized.

Below is the output generated by the `-help` flag:
```
### cfapdbparser 2020-09-01
### python version 3.8.5 | packaged by conda-forge | (default, Aug 21 2020, 18:21:27)  [GCC 7.5.0]
usage: cfapdbparse.py [-h] [-topo <name>] [-prefix <str>] [-psfgen <name>]
                      [-mut X_Y###Z] [-clv X###Y]
                      [-gra <str>,A:XXX-YYY,ZZZ,C:BBB] [-graftfile <name>]
                      [-crot <str>,A,XXX[,YYY],###] [-crotfile <name>] [-rmi]
                      [-kc] [-noc]
                      [-ror <atomselect string>,<atomselect string>] [-v]
                      <?.pdb> [<?.pdb> ...]

positional arguments:
  <?.pdb>               name(s) of pdb file to parse; first is treated as the
                        base molecule; others are

optional arguments:
  -h, --help            show this help message and exit
  -topo <name>          additional CHARMM topology files
  -prefix <str>         output PDB/PSF prefix; each file name will have the
                        format <prefix><pdbcode>.pdb/psf, where <pdbcode> is
                        the 4-letter PDB code of the base molecule.
  -psfgen <name>        name of TcL script generated as input to VMD/psfgen
  -mut X_Y###Z          specify mutation. Format: X is chainID, Y is one-
                        letter residue code to mutate FROM, ### is sequence
                        number (can be any number of digits), and Z is one-
                        letter residue code to mutate TO. Multiple -mut's can
                        be specified.
  -clv X###Y            specify cleavage site. Format: X is parent chain ID,
                        ### is residue number immediately N-terminal to the
                        cleavage site, and Y is the daughter chain ID that
                        will begin immediately C-terminal to cleavage site.
                        Multiple -clv's can be specified, each with its own
                        -clv key.
  -gra <str>,A:XXX-YYY,ZZZ,C:BBB
                        graft resids XXX-YYY of chain A in pdb <str> to chain
                        C of base molecule by overlapping resid ZZZ of chain A
                        of graft and resid BBB of chain C of base
  -graftfile <name>     input file listing all grafts (as an alternative to
                        issuing multiple -gra arguments)
  -crot <str>,A,XXX[,YYY],###
                        specify rotation about a specific torsion angle. <str>
                        is one of phi, psi, omega, chi1, or chi2. A is the
                        chainID, XXX is the resid of owner of torson, and YYY
                        (if given) marks the end of the sequence C-terminal to
                        XXX that is reoriented by a backbone rotation. ### is
                        the degrees of rotation.
  -crotfile <name>      input file listing all torsion rotations requested (as
                        an alternative to issuing multiple -crot arguments)
  -rmi                  asks psfgen to use the loopMC module to relax modeled-
                        in loops of residues missing from PDB
  -kc                   ignores SEQADV records indicating conflicts; if unset,
                        residues in conflict are mutated to their proper
                        identities
  -noc                  do not center the protein at the origin of the
                        coordinate system
  -ror <atomselect string>,<atomselect string>
                        two comma-separated, single-quoted atomselect strings
                        to define two groups of atoms whose centers of mass
                        are aligned against the global z-axis
  -v                    print verbose output during parsing
```
